#!/bin/sh

# Shim for VS Code
# ================
# If `code` is not available, run `code-insiders`.
# Refs:
# - https://github.com/devcontainers/features/blob/6654579de4c31cd9f9f9e19e873521f502403929/src/common-utils/main.sh#L590-L591
# - https://github.com/devcontainers/features/blob/main/src/common-utils/bin/code

get_in_path_except_current() {
    # Get the path to the first installation of the input command
    # that is not the current script's path.
    which -a "$1" | grep -A1 "$0" | grep -v "$0"
}

code="$(get_in_path_except_current code)"

if [ -n "$code" ]; then
    exec "$code" "$@"
elif [ "$(command -v code-insiders)" ]; then
    exec code-insiders "$@"
else
    echo "code or code-insiders is not installed" >&2
    exit 127
fi
